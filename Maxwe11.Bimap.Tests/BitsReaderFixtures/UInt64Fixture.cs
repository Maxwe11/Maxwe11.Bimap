namespace Maxwe11.Bimap.Tests.BitsReaderFixtures
{
    using System;
    using System.Collections.Generic;

    using NUnit.Framework;

    [TestFixture]
    public class UInt64Fixture
    {
        private readonly ulong[] mResult =
        {
            0, 1, 0, 3, 0, 7, 0, 15,
            0, 31, 0, 63, 0, 127, 0, 255,
            0, 511, 0, 1023, 0, 2047, 0, 4095,
            0, 8191, 0, 16383, 0, 32767, 0, 65535,
            0, 131071, 0, 262143, 0, 524287, 0, 1048575,
            0, 2097151, 0, 4194303, 0, 8388607, 0, 16777215,
            0, 33554431, 0, 67108863, 0, 134217727, 0, 268435455,
            0, 536870911, 0, 1073741823, 0, 2147483647, 0, 4294967295,
            0, 8589934591, 0, 17179869183, 0, 34359738367, 0, 68719476735,
            0, 137438953471, 0, 274877906943, 0, 549755813887, 0, 1099511627775,
            0, 2199023255551, 0, 4398046511103, 0, 8796093022207, 0, 17592186044415,
            0, 35184372088831, 0, 70368744177663, 0, 140737488355327, 0, 281474976710655,
            0, 562949953421311, 0, 1125899906842623, 0, 2251799813685247, 0, 4503599627370495,
            0, 9007199254740991, 0, 18014398509481983, 0, 36028797018963967, 0, 72057594037927935,
            0, 144115188075855871, 0, 288230376151711743, 0, 576460752303423487, 0, 1152921504606846975,
            0, 2305843009213693951, 0, 4611686018427387903, 0, 9223372036854775807, 0, 18446744073709551615
        };

        private readonly byte[] mInput =
        {
            50, 14, 15, 62, 240, 3, 254,
            0, 255,
            0, 254, 3, 240, 63,
            0, 254, 15,
            0, 255, 15,
            0, 254, 63,
            0, 240, 255, 3,
            0, 254, 255,
            0, 0, 255, 255,
            0, 0, 254, 255, 3,
            0, 240, 255, 63,
            0, 0, 254, 255, 15,
            0, 0, 255, 255, 15,
            0, 0, 254, 255, 63,
            0, 0, 240, 255, 255, 3,
            0, 0, 254, 255, 255,
            0, 0, 0, 255, 255, 255,
            0, 0, 0, 254, 255, 255, 3,
            0, 0, 240, 255, 255, 63,
            0, 0, 0, 254, 255, 255, 15,
            0, 0, 0, 255, 255, 255, 15,
            0, 0, 0, 254, 255, 255, 63,
            0, 0, 0, 240, 255, 255, 255, 3,
            0, 0, 0, 254, 255, 255, 255,
            0, 0, 0, 0, 255, 255, 255, 255,
            0, 0, 0, 0, 254, 255, 255, 255, 3,
            0, 0, 0, 240, 255, 255, 255, 63,
            0, 0, 0, 0, 254, 255, 255, 255, 15,
            0, 0, 0, 0, 255, 255, 255, 255, 15,
            0, 0, 0, 0, 254, 255, 255, 255, 63,
            0, 0, 0, 0, 240, 255, 255, 255, 255, 3,
            0, 0, 0, 0, 254, 255, 255, 255, 255,
            0, 0, 0, 0, 0, 255, 255, 255, 255, 255,
            0, 0, 0, 0, 0, 254, 255, 255, 255, 255, 3,
            0, 0, 0, 0, 240, 255, 255, 255, 255, 63,
            0, 0, 0, 0, 0, 254, 255, 255, 255, 255, 15,
            0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 15,
            0, 0, 0, 0, 0, 254, 255, 255, 255, 255, 63,
            0, 0, 0, 0, 0, 240, 255, 255, 255, 255, 255, 3,
            0, 0, 0, 0, 0, 254, 255, 255, 255, 255, 255,
            0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255,
            0, 0, 0, 0, 0, 0, 254, 255, 255, 255, 255, 255, 3,
            0, 0, 0, 0, 0, 240, 255, 255, 255, 255, 255, 63,
            0, 0, 0, 0, 0, 0, 254, 255, 255, 255, 255, 255, 15,
            0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 15,
            0, 0, 0, 0, 0, 0, 254, 255, 255, 255, 255, 255, 63,
            0, 0, 0, 0, 0, 0, 240, 255, 255, 255, 255, 255, 255, 3,
            0, 0, 0, 0, 0, 0, 254, 255, 255, 255, 255, 255, 255,
            0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255,
            0, 0, 0, 0, 0, 0, 0, 254, 255, 255, 255, 255, 255, 255, 3,
            0, 0, 0, 0, 0, 0, 240, 255, 255, 255, 255, 255, 255, 63,
            0, 0, 0, 0, 0, 0, 0, 254, 255, 255, 255, 255, 255, 255, 15,
            0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 15,
            0, 0, 0, 0, 0, 0, 0, 254, 255, 255, 255, 255, 255, 255, 63,
            0, 0, 0, 0, 0, 0, 0, 240, 255, 255, 255, 255, 255, 255, 255, 3,
            0, 0, 0, 0, 0, 0, 0, 254, 255, 255, 255, 255, 255, 255, 255,
            0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255
        };

        [TestCase(0)]
        [TestCase(65)]
        [TestCase(-1)]
        [ExpectedException(typeof(ArgumentException))]
        public void EnsureBitsCountShouldThrow(int bitsCount)
        {
            new BitsReader(mInput).ReadUInt64(bitsCount);
        }

        [Test]
        public void ReadBytesSuccessfully()
        {
            var result = new List<ulong>(mResult.Length);
            var reader = new BitsReader(mInput);

            for (int i = 1; i < 65; i++)
            {
                result.Add(reader.ReadUInt64(i));
                result.Add(reader.ReadUInt64(i));
            }

            Assert.AreEqual(mResult, result.ToArray());
        }

        [TestCase(new byte[0])]
        [TestCase(new byte[] { 1, 255, 0, 128, 2, 12, 0, 127 })]
        [ExpectedException(typeof(InvalidOperationException))]
        public void ReadShouldThrow(byte[] input)
        {
            var reader = new BitsReader(input);
            for (int i = 0; i < 2; ++i)
                reader.ReadUInt64(64);
        }
    }
}
