namespace Maxwe11.Bimap.Tests.BitsReaderFixtures
{
    using System;
    using System.Collections.Generic;

    using NUnit.Framework;

    [TestFixture]
    public class Int64Fixture
    {
        private readonly long[] mResult =
        {
            -1, 0, -2, 1, -4, 3, -8, 7,
            -16, 15, -32, 31, -64, 63, -128, 127,
            -256, 255, -512, 511, -1024, 1023, -2048, 2047,
            -4096, 4095, -8192, 8191, -16384, 16383, -32768, 32767,
            -65536, 65535, -131072, 131071, -262144, 262143, -524288, 524287,
            -1048576, 1048575, -2097152, 2097151, -4194304, 4194303, -8388608, 8388607,
            -16777216, 16777215, -33554432, 33554431, -67108864, 67108863, -134217728, 134217727,
            -268435456, 268435455, -536870912, 536870911, -1073741824, 1073741823, -2147483648, 2147483647,
            -4294967296, 4294967295, -8589934592, 8589934591, -17179869184, 17179869183, -34359738368, 34359738367,
            -68719476736, 68719476735, -137438953472, 137438953471, -274877906944, 274877906943, -549755813888, 549755813887,
            -1099511627776, 1099511627775, -2199023255552, 2199023255551, -4398046511104, 4398046511103, -8796093022208, 8796093022207,
            -17592186044416, 17592186044415, -35184372088832, 35184372088831, -70368744177664, 70368744177663, -140737488355328, 140737488355327,
            -281474976710656, 281474976710655, -562949953421312, 562949953421311, -1125899906842624, 1125899906842623, -2251799813685248, 2251799813685247,
            -4503599627370496, 4503599627370495, -9007199254740992, 9007199254740991, -18014398509481984, 18014398509481983, -36028797018963968, 36028797018963967,
            -72057594037927936, 72057594037927935, -144115188075855872, 144115188075855871, -288230376151711744, 288230376151711743, -576460752303423488, 576460752303423487,
            -1152921504606846976, 1152921504606846975, -2305843009213693952, 2305843009213693951, -4611686018427387904, 4611686018427387903, -9223372036854775808, 9223372036854775807,
        };

        private readonly byte[] mInput =
        {
            25, 135, 7, 31, 248, 1, 127, 128, 127,
            0, 255, 1, 248, 31,
            0, 255, 7, 128, 255, 7,
            0, 255, 31,
            0, 248, 255, 1,
            0, 255, 127,
            0, 128, 255, 127,
            0, 0, 255, 255, 1,
            0, 248, 255, 31,
            0, 0, 255, 255, 7,
            0, 128, 255, 255, 7,
            0, 0, 255, 255, 31,
            0, 0, 248, 255, 255, 1,
            0, 0, 255, 255, 127,
            0, 0, 128, 255, 255, 127,
            0, 0, 0, 255, 255, 255, 1,
            0, 0, 248, 255, 255, 31,
            0, 0, 0, 255, 255, 255, 7,
            0, 0, 128, 255, 255, 255, 7,
            0, 0, 0, 255, 255, 255, 31,
            0, 0, 0, 248, 255, 255, 255, 1,
            0, 0, 0, 255, 255, 255, 127,
            0, 0, 0, 128, 255, 255, 255, 127,
            0, 0, 0, 0, 255, 255, 255, 255, 1,
            0, 0, 0, 248, 255, 255, 255, 31,
            0, 0, 0, 0, 255, 255, 255, 255, 7,
            0, 0, 0, 128, 255, 255, 255, 255, 7,
            0, 0, 0, 0, 255, 255, 255, 255, 31,
            0, 0, 0, 0, 248, 255, 255, 255, 255, 1,
            0, 0, 0, 0, 255, 255, 255, 255, 127,
            0, 0, 0, 0, 128, 255, 255, 255, 255, 127,
            0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 1,
            0, 0, 0, 0, 248, 255, 255, 255, 255, 31,
            0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 7,
            0, 0, 0, 0, 128, 255, 255, 255, 255, 255, 7,
            0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 31,
            0, 0, 0, 0, 0, 248, 255, 255, 255, 255, 255, 1,
            0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 127,
            0, 0, 0, 0, 0, 128, 255, 255, 255, 255, 255, 127,
            0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 1,
            0, 0, 0, 0, 0, 248, 255, 255, 255, 255, 255, 31,
            0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 7,
            0, 0, 0, 0, 0, 128, 255, 255, 255, 255, 255, 255, 7,
            0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 31,
            0, 0, 0, 0, 0, 0, 248, 255, 255, 255, 255, 255, 255, 1,
            0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 127, 
            0, 0, 0, 0, 0, 0, 128, 255, 255, 255, 255, 255, 255, 127,
            0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 1,
            0, 0, 0, 0, 0, 0, 248, 255, 255, 255, 255, 255, 255, 31,
            0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 7,
            0, 0, 0, 0, 0, 0, 128, 255, 255, 255, 255, 255, 255, 255, 7,
            0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 31,
            0, 0, 0, 0, 0, 0, 0, 248, 255, 255, 255, 255, 255, 255, 255, 1,
            0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 127,
            0, 0, 0, 0, 0, 0, 0, 128, 255, 255, 255, 255, 255, 255, 255, 127
        };

        [TestCase(0)]
        [TestCase(65)]
        [TestCase(-1)]
        [ExpectedException(typeof(ArgumentException))]
        public void EnsureBitsCountShouldThrow(int bitsCount)
        {
            new BitsReader(mInput).ReadInt64(bitsCount);
        }

        [Test]
        public void ReadBytesSuccessfully()
        {
            var result = new List<long>(mResult.Length);
            var reader = new BitsReader(mInput);

            for (int i = 1; i < 65; i++)
            {
                result.Add(reader.ReadInt64(i));
                result.Add(reader.ReadInt64(i));
            }

            Assert.AreEqual(mResult, result.ToArray());
        }

        [TestCase(new byte[0])]
        [TestCase(new byte[] { 1, 255, 0, 128, 2, 12, 0, 127 })]
        [ExpectedException(typeof(InvalidOperationException))]
        public void ReadShouldThrow(byte[] input)
        {
            var reader = new BitsReader(input);
            for (int i = 0; i < 2; ++i)
                reader.ReadInt64();
        }
    }
}
